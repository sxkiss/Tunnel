# TunnelManager 使用与打包说明

本项目是一个基于 Python 和 Tkinter 的 Cloudflare Tunnel 客户端管理工具，旨在提供一个简洁的图形界面（GUI）和命令行界面（CLI），用于将远程服务（通过 Cloudflare Tunnel 访问）安全地映射到本地端口。

---

## 一、 软件使用说明

本工具打包后为单个可执行文件，无需安装，开箱即用。它的核心功能是执行 `cloudflared access` 命令，让您可以在本地通过 `localhost:<端口>` 的方式访问一个远程服务。

### 1. 图形界面 (GUI) 模式

直接双击运行 `TunnelManager` 可执行文件即可启动图形界面。

**主要操作:**

*   **隧道列表**: 主窗口会显示所有已配置的连接及其状态（名称、协议、远程主机名、映射的本地端口、运行状态）。
*   **添加隧道**: 点击 `添加隧道` 按钮，在弹出的对话框中填写以下信息：
    *   **连接名称**: 自定义名称，方便识别（例如“公司远程桌面”）。
    *   **远程协议**: 远程服务的协议，如 `rdp`, `tcp`, `ssh` 等。
    *   **远程主机名**: 您要访问的、通过 Cloudflare Tunnel 暴露的服务域名，例如 `rdp.example.com`。
    *   **映射到本地端口**: 您希望在本地用哪个端口来访问这个远程服务，例如 `3389`。配置完成后，您可以通过访问 `localhost:3389` 来连接远程服务。
*   **编辑隧道**: 在列表中选中一个连接，然后点击 `编辑隧道` 按钮进行修改。
*   **删除隧道**: 在列表中选中一个连接，然后点击 `删除隧道` 按钮。如果连接正在运行，程序会先尝试断开它。
*   **启动/停止隧道**: **双击**列表中的任意连接项，即可在其“启动”和“停止”状态之间切换。启动后，本地端口监听开始；停止后，监听结束。

### 2. 命令行 (CLI) 模式

在终端中，使用 `--cli` 参数启动命令行模式。

**基本用法:**
```bash
# 在 Linux/macOS 上
./TunnelManager --cli [命令]

# 在 Windows 上
TunnelManager.exe --cli [命令]```

**可用命令:**

*   `list` (默认): 显示所有隧道的配置和状态。
*   `add`: 添加一个新的隧道连接。 (`./TunnelManager --cli add "名称" 主机名 端口 --protocol 协议`)
*   `update`: 更新一个已有的隧道连接。
*   `delete`: 删除一个隧道连接。
*   `start`: 启动一个隧道连接。
*   `stop`: 停止一个隧道连接。

---

## 二、 多平台打包说明

本项目提供了一套平台原生的自动化脚本，用于在不同操作系统上打包生成独立的可执行文件。所有构建脚本都已实现智能化，首次运行时会自动创建虚拟环境并安装依赖；后续运行时则会跳过这些步骤，实现快速打包。

**核心原则**: 打包操作必须在目标操作系统上进行（例如，在 Windows 上打包 `.exe`）。

### 1. 在 Windows 上打包

我们为传统的 **CMD** 和现代的 **PowerShell** 提供了两套完全独立的脚本，请根据您打开的终端类型选择对应的指令。

#### 首次环境准备 (仅需一次)

如果您的 Windows 系统中没有安装 Python：

*   **CMD 用户**:
    1.  找到 `install_python.bat` 文件。
    2.  **右键点击** -> **以管理员身份运行**。
*   **PowerShell 用户**:
    1.  找到 `install_python.ps1` 文件。
    2.  **右键点击** -> **使用 PowerShell 运行** (并同意管理员权限)。

脚本会自动下载并静默安装 Python。完成后，**请务必关闭并重新打开一个新的终端窗口**。

#### 日常构建

*   **CMD 用户**:
    ```cmd
    build.bat
    ```
*   **PowerShell 用户**:
    ```powershell
    .\build.ps1
    ```

### 2. 在 Linux & macOS 上打包

Linux 和 macOS 使用同一套 Shell 脚本。

#### 首次环境准备 (仅需一次)

如果您的系统中没有安装 Python：

1.  打开终端，进入项目目录。
2.  给环境安装脚本赋予执行权限：`chmod +x install_python.sh`
3.  以 `sudo` 权限运行脚本：`sudo ./install_python.sh`

脚本会自动检测您的系统发行版 (Debian/Ubuntu, Fedora/CentOS, Arch) 或 macOS (使用 Homebrew)，并调用对应的包管理器来安装 Python。

#### 日常构建

1.  打开终端，进入项目目录。
2.  给构建脚本赋予执行权限：`chmod +x build.sh`
3.  运行脚本：`./build.sh`

### 打包产物

无论在哪种系统上，打包成功后，最终的可执行文件都会生成在项目根目录下的 `dist` 文件夹中。